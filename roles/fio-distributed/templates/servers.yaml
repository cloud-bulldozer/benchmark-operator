---
kind: Pod
apiVersion: v1
metadata:
  name: 'fio-server-{{ item.0|int + 1 }}'
  namespace: '{{ operator_namespace }}'
  labels:
    app: fio-bench-server-{{ item.0|int + 1 }}
    type: fio-bench-server
spec:
  containers:
  - name: fio-server
    image: "quay.io/cloud-bulldozer/fio:latest"
    ports:
      - containerPort: 8765
    command: ["/bin/sh", "-c"]
    args: ["fio --server"]
{% if fiod.storageclass is defined %}
    volumeMounts:
    - name: persistent-volume
      mountPath: "/mnt/pvc"
{% endif %}
  restartPolicy: Never
{% if fiod.pin %}
  nodeSelector:
    kubernetes.io/hostname: '{{ fiod.pin_server }}'
{% endif %}
{% if fiod.storageclass is defined %}
  volumes:
  - name: persistent-volume
    persistentVolumeClaim:
      claimName: "{{ item.1.result.metadata.name }}"
{% endif %}
