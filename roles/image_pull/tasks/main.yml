---
- name: Set building state
  include_role:
    name: benchmark_state
    tasks_from: building.yml

- block:
  
  - name: Image pull pods
    k8s:
      state: present
      definition: "{{ lookup('template', 'image_pull.yml') }}"

  - operator_sdk.util.k8s_status:
      api_version: ripsaw.cloudbulldozer.io/v1alpha1
      kind: Benchmark
      name: "{{ ansible_operator_meta.name }}"
      namespace: "{{ operator_namespace }}"
      status:
        state: Running
        complete: false

  when: benchmark_state.resources[0].status.state == "Building"

- include_role:
    name: benchmark_state
    tasks_from: completed.yml
  when: benchmark_state.resources[0].status.state == "Running"
